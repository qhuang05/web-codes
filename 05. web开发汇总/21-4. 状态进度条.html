<!DOCTYPE html>
<html lang="en">
<head>
    <script src="http://www.jq22.com/jquery/1.11.1/jquery.min.js"></script>
    <style>
        .scroll-wrap{
            width:400px;
            height:10px;
            padding:20px 0;
            background: #000;
            display: inline-block;
        }
        .scroll-bar{
            width: 100%;
            height: 100%;
            background: #ccc;
            border-radius: 2em;
            -webkit-border-radius: 2em;
            -moz-border-radius: 2em;
            cursor: pointer;
            position: relative;
        }
        .scroll-track{
            width: 0;
            height: 10px;
            background: #ff4400;
            border-radius: 2em;
            -webkit-border-radius: 2em;
            -moz-border-radius: 2em;
        }
        .scroll-point{
            width: 25px;
            height: 25px;
            background: #efefef;
            border-radius: 50%;
            border:1px solid #ccc;
            -webkit-box-shadow: 0px 0px 5px #ccc;
            -moz-box-shadow: 0px 0px 5px #ccc;
            box-shadow: 0px 0px 5px #ccc;
            position: absolute;
            left:0;
            top: -9px;
            cursor: pointer
        }
        .scroll-point:hover{
            background: #ff4400;
            border:1px solid #fff;
        }
    </style>
</head>
<body>
    <div class="scroller">
        <div class="scroll-wrap">
            <div class="scroll-bar">
                <div class="scroll-track"></div>
                <div class="scroll-point"></div>
            </div>
        </div>
        <input type="text" value="0" class="scroll-input">
    </div>
<script type="text/javascript">
$(function(){
    $('.scroll-wrap').processBar();
});
$.fn.processBar = function(opt){
    let $scroller = $(this),
        $scrollTrack = $(this).find('.scroll-track'),
        $scrollPoint = $(this).find('.scroll-point'),
        $input = $('input');
    opt = Object.assign({}, {
        max: 100,
        value: 20,
        step: 1
    }, opt);
    // 初始化
    let currentX = 0;
    let main = {
        init: function(){
            currentX = $scroller.width()*(opt.value/opt.max);
            $scrollTrack.css('width', currentX+5+'px');
            $scrollPoint.css('margin-left', currentX+'px');
            $input.val(opt.value);
        },
        setValue(){

        },
        move: function(){
            let flag = false, 
                scrollerWidth = $scroller.width(),
                pointX;
            $scrollPoint.mousedown(()=>{
                flag = true;
                $scroller.mousemove((e)=>{
                    if(!flag){
                        return;
                    }
                    console.log('move...');
                    pointX = e.clientX - $scroller.offset().left;
                    $scrollPoint.css('margin-left', pointX+'px');
                    $scrollTrack.css('width', pointX+2+'px');
                    if(pointX+25>=scrollerWidth){
                        $scrollTrack.css('width', scrollerWidth+'px');
                        $scrollPoint.css('margin-left', (scrollerWidth-25)+'px');
                        opt.value = opt.max;
                    } else if(pointX<=0){
                        $scrollTrack.css('width', 0);
                        $scrollPoint.css('margin-left', 0);
                        opt.value = 0;
                    } else{
                        opt.value = Math.round(100*(pointX/scrollerWidth));
                    }
                    $input.val(opt.value);
                });
            });
            /* 不论鼠标指针离开被选元素还是任何子元素，都会触发 mouseout 事件。
            只有在鼠标指针离开被选元素时，才会触发 mouseleave 事件。 */
            $scroller.mouseleave((e)=>{
                flag = false;
                // $scroller.off('mousemove');
            });
            $(document).on('mouseup', ()=>{
                flag = false;
                // $scroller.off('mousemove');
                opt.value = Math.round(100*(pointX/scrollerWidth));
                if(opt.value>=opt.max){
                    opt.value = opt.max;
                } else if(opt.value<=0){
                    opt.value = 0;
                }
                $input.val(opt.value);
            })
            $input.keydown((event)=>{
                if(event.keyCode == 13){
                    let ivalue = parseInt($input.val());
                    if(ivalue<0 || ivalue>opt.max){
                        return;
                    }
                    currentX = $scroller.width()*(ivalue/opt.max);
                    $scrollTrack.css('width', currentX+2+'px');
                    $scrollPoint.css('margin-left', currentX+'px');
                }
            })
        }
    };
    main.init();
    main.move();
}
</script>
</body>
</html>